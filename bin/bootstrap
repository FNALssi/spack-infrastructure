#!/bin/bash

# pull down spack-infrastructure
# use it to install
dest=${1:-$PWD}
ver=${2:-v2_17_01_hotfixes}
spackver=${3:-v0.17.1.fermi}

mkdir -p $dest/spack-infrastructure/$ver
cd $dest

until git clone https://github.com/FNALssi/spack-infrastructure.git -b ${ver} spack-infrastructure/$ver/NULL/
do
    rm -rf 
done

PATH=$dest/spack-infrastructure/$ver/NULL/bin:$PATH

make_spack --spack_release $spackver --minimal -u $dest

source $dest/setup-env.sh

cd $dest/spack-infrastructure/$ver/NULL && bin/declare_simple spack-infrastructure $ver

